<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Laborator 1 - Probleme dinamic</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
    }
    h1, h2 {
      color: #333;
    }
    .problem {
      border: 1px solid #ccc;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
      background-color: #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .buttons {
      margin-top: 10px;
    }
    .buttons button {
      margin-right: 10px;
      padding: 5px 10px;
      border: none;
      background-color: #0366d6;
      color: white;
      border-radius: 3px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .buttons button:hover {
      background-color: #024f9c;
    }
    .toggle-content {
      margin-top: 10px;
      padding: 10px;
      background-color: #f7f7f7;
      border: 1px solid #ddd;
      border-radius: 3px;
      display: none;
    }
    .toggle-content a {
      color: #0366d6;
      text-decoration: none;
    }
    .toggle-content img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 5px auto;
    }
    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      background: #eee;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
  <script>
    // Configura»õie: Repository-ul »ôi folderul »õintƒÉ
    const REPO_OWNER = 'chiril-covali';
    const REPO_NAME = 'programare-vizuala';
    const TARGET_FOLDER = 'laborator1';
    // URL pentru GitHub Pages (folosit pentru imagini)
    const GITHUB_PAGES_URL = `https://${REPO_OWNER}.github.io/${REPO_NAME}/${TARGET_FOLDER}`;
    // URL de bazƒÉ pentru GitHub pentru codul sursƒÉ
    const GITHUB_SOURCE_URL = `https://github.com/${REPO_OWNER}/${REPO_NAME}/blob/main/${TARGET_FOLDER}`;

    // Ob»õine iconi»õƒÉ pe baza extensiei fi»ôierului
    function getFileIcon(filename) {
      const extension = filename.split('.').pop().toLowerCase();
      const icons = {
        'py': 'üë®‚Äçüíª',
        'png': 'üñºÔ∏è',
        'md': 'üìò',
        'default': 'üìÑ'
      };
      return icons[extension] || icons.default;
    }
    
    // Toggle pentru elemente (afi»ôare/ascundere)
    function toggleContent(id) {
      const el = document.getElementById(id);
      if(el.style.display === 'none' || el.style.display === '') {
        el.style.display = 'block';
      } else {
        el.style.display = 'none';
      }
    }

    // Func»õie pentru a ob»õine con»õinutul unui folder de pe GitHub folosind API-ul
    async function fetchFolderContents(url) {
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`Eroare HTTP: ${response.status}`);
        return response.json();
      } catch (error) {
        console.error('Fetch error:', error);
        return [];
      }
    }
    
    // Func»õie pentru a √ÆncƒÉrca con»õinutul condi»õiilor din fi»ôierul markdown
    async function loadConditionContent(downloadUrl, divId) {
      try {
        const response = await fetch(downloadUrl);
        if (!response.ok) throw new Error(`Nu s-a putut √ÆncƒÉrca condi»õia: ${response.status}`);
        const text = await response.text();
        const conditionDiv = document.getElementById(divId);
        // Afi»ôeazƒÉ textul √Æn interiorul unui tag <pre> pentru a pƒÉstra formatul markdown
        conditionDiv.innerHTML = `<pre>${text}</pre>`;
      } catch (error) {
        console.error("Error loading condition:", error);
      }
    }
    
    // Func»õia principalƒÉ ce listeazƒÉ problemele din folderul TARGET_FOLDER
    async function listProblems() {
      const problemsContainer = document.getElementById('problemsContainer');
      // URL-ul API pentru folderul TARGET_FOLDER
      const targetFolderUrl = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${TARGET_FOLDER}`;
      const folders = await fetchFolderContents(targetFolderUrl);
      
      // FiltrƒÉm folder-ele care au nume numerice (presupunem cƒÉ acestea reprezintƒÉ problemele)
      const problemFolders = folders.filter(item => item.type === 'dir' && !isNaN(item.name));
      // SorteazƒÉ folderele numeric
      problemFolders.sort((a, b) => Number(a.name) - Number(b.name));
      
      // Parcurgem fiecare folder de problemƒÉ
      for (const folder of problemFolders) {
        const folderContents = await fetchFolderContents(folder.url);
        
        // CƒÉutƒÉm fi»ôierele:
        // - Fi»ôierul de cod (presupunem cƒÉ acesta are extensia .py)
        const codeFile = folderContents.find(item => item.name.toLowerCase().endsWith('.py'));
        // - Fi»ôierul de condi»õii (markdown, orice fi»ôier .md)
        const conditionFile = folderContents.find(item => item.name.toLowerCase().endsWith('.md'));
        // - Toate imaginile (fi»ôiere .png); poate fi mai mult de unul
        const imageFiles = folderContents.filter(item => item.name.toLowerCase().endsWith('.png'));
        
        // ContinuƒÉm numai dacƒÉ existƒÉ cel pu»õin una dintre aceste fi»ôiere
        if (!codeFile && !conditionFile && imageFiles.length === 0) continue;
        
        // Cream containerul pentru problemƒÉ
        const problemDiv = document.createElement('div');
        problemDiv.className = 'problem';
        problemDiv.id = `problem${folder.name}`;
        
        // Titlul problemei (folosind numƒÉrul folderului)
        const heading = document.createElement('h2');
        heading.textContent = `Problema ${folder.name}`;
        problemDiv.appendChild(heading);
        
        // Sec»õiune de butoane
        const buttonsDiv = document.createElement('div');
        buttonsDiv.className = 'buttons';
        
        // Buton pentru condi»õii, dacƒÉ existƒÉ fi»ôierul markdown
        if (conditionFile) {
          const condBtn = document.createElement('button');
          condBtn.textContent = "AratƒÉ condi»õiile " + getFileIcon(conditionFile.name);
          const condDivId = `cond${folder.name}`;
          condBtn.onclick = async () => {
            // DacƒÉ div-ul este gol, √ÆncarcƒÉ condi»õiile
            const condDiv = document.getElementById(condDivId);
            if (!condDiv.dataset.loaded) {
              await loadConditionContent(conditionFile.download_url, condDivId);
              condDiv.dataset.loaded = "true";
            }
            toggleContent(condDivId);
          };
          buttonsDiv.appendChild(condBtn);
        }
        
        // Buton pentru codul sursƒÉ, dacƒÉ existƒÉ fi»ôierul .py
        if (codeFile) {
          const codeBtn = document.createElement('button');
          codeBtn.textContent = "AratƒÉ codul sursƒÉ " + getFileIcon(codeFile.name);
          const codeDivId = `code${folder.name}`;
          // Deschide link-ul cƒÉtre GitHub la fi»ôierul de cod
          codeBtn.onclick = () => {
            window.open(`${GITHUB_SOURCE_URL}/${folder.name}/${encodeURIComponent(codeFile.name)}`, '_blank');
          };
          buttonsDiv.appendChild(codeBtn);
        }
        
        // Buton pentru imagini, dacƒÉ existƒÉ cel pu»õin un fi»ôier de imagine
        if (imageFiles.length > 0) {
          const imgBtn = document.createElement('button');
          imgBtn.textContent = "AratƒÉ imaginea " + getFileIcon("png");
          const imgDivId = `img${folder.name}`;
          imgBtn.onclick = () => toggleContent(imgDivId);
          buttonsDiv.appendChild(imgBtn);
        }
        
        problemDiv.appendChild(buttonsDiv);
        
        // Div pentru condi»õii (markdown)
        if (conditionFile) {
          const condDiv = document.createElement('div');
          condDiv.className = 'toggle-content';
          condDiv.id = `cond${folder.name}`;
          // Ini»õial, rƒÉm√¢ne gol; va fi umplut c√¢nd se apasƒÉ butonul
          problemDiv.appendChild(condDiv);
        }
        
        // Div pentru imagini: afi»ôƒÉm toate imaginile
        if (imageFiles.length > 0) {
          const imgDiv = document.createElement('div');
          imgDiv.className = 'toggle-content';
          imgDiv.id = `img${folder.name}`;
          imageFiles.forEach(imageFile => {
            const imgElem = document.createElement('img');
            // Folosim GitHub Pages URL pentru afi»ôarea imaginilor
            imgElem.src = `${GITHUB_PAGES_URL}/${folder.name}/${encodeURIComponent(imageFile.name)}`;
            imgElem.alt = `Imagine Problema ${folder.name} - ${imageFile.name}`;
            imgDiv.appendChild(imgElem);
          });
          problemDiv.appendChild(imgDiv);
        }
        
        problemsContainer.appendChild(problemDiv);
      }
    }
    
    document.addEventListener('DOMContentLoaded', listProblems);
  </script>
</head>
<body>
  <h1>Laborator 1 - Probleme</h1>
  <div id="problemsContainer">
    <p>Se √ÆncarcƒÉ problemele...</p>
  </div>
</body>
</html>
